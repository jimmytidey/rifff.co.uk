package {	import fl.controls.TextInput;	import flash.events.*;	import flash.display.*;	import flash.text.TextField;	import fl.controls.Button;	import flash.media.SoundMixer;	import flash.media.SoundChannel;	public class Score extends MovieClip{		public var score:Array = new Array();				public function generate(jsonData, grid, soundContainer, number_of_steps, step_time) {								trace('writing the score');						//declare the arrays 			for (var bank_index:int =0; bank_index < jsonData['banks'].length; bank_index++) {				score[bank_index] = new Array() 							for (var bank_option_index:int =0; bank_option_index < jsonData['banks'][bank_index]['bank_options'].length; bank_option_index++) {					score[bank_index][bank_option_index] = new Array();					for (var step_number:int =0; step_number < number_of_steps; step_number++) {						score[bank_index][bank_option_index][step_number] = new Array();						score[bank_index][bank_option_index][step_number]['action'] = '';						score[bank_index][bank_option_index][step_number]['offset'] = '0';							if (grid[bank_index][step_number][bank_option_index] == 100) { 							grid[bank_index][step_number]['certain_play'] = bank_option_index;							trace("bank index" + bank_index + " bank option index " + bank_option_index + " step number" + step_number); 						}					}				}			}						//now set the arrays 			for (bank_index=0; bank_index < jsonData['banks'].length; bank_index++) {				for (step_number=0; step_number < number_of_steps; step_number++) {														//if there is one step that is going to play, play it and stop everything else 					if(grid[bank_index][step_number]['certain_play'] != undefined) {						for (bank_option_stop_index=0; bank_option_stop_index < jsonData['banks'][bank_index]['bank_options'].length; bank_option_stop_index++) {							score[bank_index][bank_option_stop_index][step_number]['action'] = "stop";						}												var certain_number = grid[bank_index][step_number]['certain_play'];						if (jsonData['banks'][bank_index]['bank_options'][certain_number]['loop'] == "true") {							score[bank_index][certain_number][step_number]['action'] = "loop";						}						else { 							score[bank_index][certain_number][step_number]['action'] = "play";						}					}															else { 						for (bank_option_index=0; bank_option_index < jsonData['banks'][bank_index]['bank_options'].length; bank_option_index++) {							if (jsonData['banks'][bank_index]['bank_options'][bank_option_index]['overplay'] == 'true') {																var file_location = jsonData['banks'][bank_index]['bank_options'][bank_option_index]['file_location'];								if (file_location != undefined) { 									var file_location_array:Array = file_location.split(".");									var clean_file_location = file_location_array[0];										if (soundContainer[clean_file_location].length != undefined) { 										var lookback_step_number = soundContainer[clean_file_location].length / step_time;																				for (var check_step = 0; check_step <=lookback_step_number; check_step++) { 											var test = step_number - check_step; 											if (test >= 0) {												if(grid[bank_index][test][bank_option_index] == 100) { 													var time_ago = check_step*step_time; 													if (jsonData['banks'][bank_index]['bank_options'][bank_option_index]['loop']  == "true") {														trace('lookback play command triggered' + bank_option_index + " step:" + step_number); 														score[bank_index][bank_option_index][step_number]['action'] = "loop";													} else { 														score[bank_index][bank_option_index][step_number]['action'] = "play";														score[bank_index][bank_option_index][step_number]['offset'] = time_ago; 													}												}											}										}									}								}							}							//work out what we need to stop 							else { 								score[bank_index][bank_option_index][step_number]['action'] = "stop";								trace("bank index:" + bank_index + "  bank option:" + bank_option_index + "  step" +step_number);							}						}					}				}			}		}	}}